<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Well-Tegra | Final Version</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Roboto+Mono&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; font-weight: 500; background-color: #0f172a; color: #e2e8f0; }
        h1, h2, h3, h4, h5, h6 { font-weight: 800; color: #f8fafc; }
        p, span, label, td, li { color: #e2e8f0; line-height: 1.65; }
        .header { background-color: rgba(15, 23, 42, 0.8); backdrop-filter: blur(8px); border-bottom: 1px solid #1e293b; }
        .nav-link { color: #94a3b8; }
        .nav-link.active { color: #60a5fa; border-bottom-color: #60a5fa; }
        .light-card { background-color: #1e293b; border: 1px solid #334155; }
        .planner-card { transition: all 0.2s ease-in-out; opacity: 0; animation: fadeInUp 0.5s ease-out forwards; }
        .planner-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1); }
        .planner-card.selected { border-color: #60a5fa; transform: translateY(-5px); border-width: 2px; }
        .planner-card[data-well-id="W666"] { border-color: #ef4444; background-image: linear-gradient(rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0)); }
        .planner-card[data-well-id="W666"].selected { border-color: #ef4444 !important; box-shadow: 0 10px 15px -3px rgb(239 68 68 / 0.2); }
        .status-active-restoredproduction, .status-passed { background-color: #10b981; color: #ffffff; }
        .status-shut-in-wellintegrityissues, .status-failed, .status-slightleak, .status-repaired { background-color: #ef4444; color: #ffffff; }
        .status-overdue, .status-toppedup { background-color: #f59e0b; color: #ffffff; }
        .performer-view .dashboard-grid { display: grid; grid-template-columns: 2fr 5fr 3fr; gap: 1.5rem; height: calc(100vh - 80px); }
        .performer-view .kpi-card { background-color: #1e293b; border-radius: 0.5rem; border: 1px solid #334155; }
        .performer-view .alarm, .emergency-bg { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); background-color: rgba(239, 68, 68, 0.2); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        .gauge-text { font-family: 'Roboto Mono', monospace; }
        .text-normal { color: #5eead4; } .stroke-normal { stroke: #5eead4; }
        .text-warning { color: #facc15; } .stroke-warning { stroke: #facc15; }
        .text-danger { color: #f87171; } .stroke-danger { stroke: #f87171; }
        .hero-section { position: relative; overflow: hidden; }
        #hero-video { position: absolute; top: 50%; left: 50%; min-width: 100%; min-height: 100%; z-index: -100; transform: translateX(-50%) translateY(-50%); }
        .hero-overlay { position: absolute; inset: 0; background-color: rgba(15, 23, 42, 0.8); z-index: -50; }
        .hero-section h1, .hero-section p { text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7); }
        .modal-tab.active { color: #60a5fa; border-bottom-color: #60a5fa; }
        .schematic-label { font-family: 'Roboto Mono', monospace; font-size: 10px; }
        .table-header { background-color: #334155; }
        .table-row-alt { background-color: rgba(30, 41, 59, 0.5); }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in-up { opacity: 0; animation: fadeInUp 0.6s ease-out forwards; }
    </style>
</head>
<body class="theme-dark">

<div id="welcome-screen" class="fixed inset-0 bg-slate-900 flex items-center justify-center z-50 transition-opacity duration-500">
    <div class="text-center">
        <img src="https://welltegra.network/assets/logo.png" alt="Well-Tegra Logo" class="h-24 w-auto mx-auto mb-8 animate-pulse">
        <div class="bg-slate-800 p-8 rounded-lg shadow-2xl w-80">
            <h2 class="text-2xl font-bold text-white mb-6">Platform Login</h2>
            <div class="space-y-4">
                <input type="text" id="username" placeholder="Username" value="demo@welltegra.com" class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500">
                <input type="password" id="password" placeholder="Password" value="password" class="w-full p-3 rounded-md bg-slate-700 border border-slate-600 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500">
            </div>
            <button id="login-btn" class="mt-6 w-full bg-teal-600 hover:bg-teal-500 text-white font-bold py-3 px-4 rounded-md transition-colors active:scale-95">Login</button>
        </div>
    </div>
</div>

<div id="app-container" class="min-h-screen flex-col hidden">
    <header id="app-header" class="header sticky top-0 z-30 transition-colors">
        <div class="max-w-full mx-auto py-3 px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <img src="https://welltegra.network/assets/logo.png" alt="Well-Tegra Logo" class="h-12 w-auto mr-3">
                    <h1 id="header-title" class="text-xl font-bold hidden md:block">Well-Tegra</h1>
                </div>
                <nav id="header-nav" class="flex-1 flex items-center justify-center space-x-2 md:space-x-4"></nav>
                <div id="header-details" class="flex items-center space-x-4"></div>
            </div>
        </div>
    </header>

    <main id="main-content" class="flex-1"></main>
    
    <div id="well-history-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="light-card w-full max-w-6xl max-h-[90vh] rounded-lg shadow-2xl flex flex-col">
            <div class="flex justify-between items-center p-4 border-b border-slate-700">
                <h3 id="modal-title" class="text-2xl font-bold"></h3>
                <button id="close-modal-btn" class="text-3xl font-bold hover:text-red-500">&times;</button>
            </div>
            <div id="modal-content" class="p-6 overflow-y-auto"></div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- DATA STORE ---
    const wellData = [
        { 
            id: 'W666', name: 'The Well From Hell', field: 'Devils Basin', status: 'Shut-in - Well Integrity Issues', 
            issue: 'Multiple fish (CT & Wireline) in hole with suspected tubing-to-annulus communication.', 
            history: [ { date: '2026-05-22', operation: 'Coiled Tubing: Milling Operation', problem: 'Aggressive milling led to coiled tubing fatigue and a pipe fracture. CT parted at 11,800ft.', lesson: 'CT fatigue must be tracked meticulously. Milling in HPHT wells without clear visuals is a high-risk gamble.' } ], 
            dailyReports: [ { date: '2026-08-04', summary: 'Day 3 of fishing for CT. Unable to get a latch. Jarring ceased. Fish (CT) and fish (Wireline tools) now both left in hole.', npt: 24.0, toolstringRun: ['Rope Socket', 'Stem', 'Spang Jars', 'CT Overshot'] } ],
            treeData: [
                { id: 'SV', name: 'Swab Valve', type: 'Gate', actuator: 'Manual', pressure: 10000, last_insp: '2025-01-10', status: 'Passed'},
                { id: 'UMV', name: 'Upper Master Valve', type: 'Gate', actuator: 'Hydraulic', pressure: 10000, last_insp: '2025-01-10', status: 'Passed'},
                { id: 'LMV', name: 'Lower Master Valve', type: 'Gate', actuator: 'Hydraulic', pressure: 10000, last_insp: '2024-02-05', status: 'Slight Leak'},
                { id: 'KWV', name: 'Kill Wing Valve', type: 'Gate', actuator: 'Manual', pressure: 10000, last_insp: '2025-01-10', status: 'Passed'},
                { id: 'PWV', name: 'Production Wing Valve', type: 'Gate', actuator: 'Hydraulic', pressure: 10000, last_insp: '2023-07-21', status: 'Overdue'},
            ],
            treeHistory: [
                { date: '2025-06-20', activity: 'Annulus Top-Up', summary: 'Topped up A annulus with 2 bbls of fluid.', status: 'ToppedUp'},
                { date: '2024-08-15', activity: 'Gate Valve Repair', summary: 'Replaced gate and seats on Production Wing Valve (PWV) due to passing test.', status: 'Repaired'},
                { date: '2024-02-05', activity: 'Annual PMS', summary: 'Full tree integrity test. LMV showed slight pressure drop over 15 mins. Flagged for monitoring.', status: 'Passed'},
            ]
        },
        // Other case study wells
        { id: 'W001', name: 'Gullfaks C-34', field: 'Gullfaks', status: 'Active - Underperforming', issue: 'Suspected scale buildup.', history: [ { date: '2024-02-20', operation: 'Coiled Tubing Scale Cleanout', problem: 'Motor stalled multiple times due to unexpectedly hard scale. The fluid system was unable to efficiently lift the large volume of debris, causing a pack-off scare.', lesson: 'A high-viscosity fluid sweep is essential for hole cleaning when milling hard debris to prevent packing off.' } ]},
        { id: 'W002', name: 'Statfjord A-12', field: 'Statfjord', status: 'Active - Low Injectivity', issue: 'Possible perforation plugging.', history: [ { date: '2024-04-11', operation: 'Production Logging (Wireline)', problem: 'Logging tool string became stuck at 2,900m. Jarring was unsuccessful. Had to perform a "cut and thread" fishing operation to retrieve the tool.', lesson: 'Wellbore tortuosity data must be consulted. A rigid toolstring run into a high-angle section will cause a hangup. The risk can be flagged automatically.' } ]},
        { id: 'W003', name: 'Oseberg B-21', field: 'Oseberg', status: 'Shut-in - Well Integrity Issues', issue: 'Suspected downhole safety valve failure.', history: [ { date: '2023-09-14', operation: 'Slickline: Attempted DHSV Lock-Open', problem: 'Ran lock-open tool. Tool sheared prematurely due to debris in the control line, leaving a new fish on top of the already faulty DHSV.', lesson: 'A simple control line flush was missed in the procedure. This highlights a failure in planning and assessing prerequisite tasks.' } ]}
    ];
    const problemsData = [ 
        { id: 'prob1', name: 'Complex Wellbore Obstruction / Fish', description: 'Multiple fish in hole with suspected tubing/casing integrity failure.' }
    ];
    const proceduresData = {
        siloed: { 
            name: "Conventional Fishing Operation", conveyance: 'Coiled Tubing', toolWeight: 2500, frictionCoefficient: 0.35,
            steps: ["RIH with Coiled Tubing and standard overshot.", "Attempt to latch fish at 11,800ft.", "Jar on fish to free.", "POOH with fish."],
            isFlawed: true
        },
        integrated: { 
            name: "AI-Guided Fishing & Repair", conveyance: 'Multi-Stage', toolWeight: 1200, frictionCoefficient: 0.28,
            steps: ["RIH with CT and circulate high-viscosity sweeps (Lesson from W001).", "POOH Coiled Tubing.", "RIH with Wireline cutting tool to cut tangled fish (Lesson from W002).", "RIH with heavy-duty overshot to latch and retrieve fish (Lesson from W003).", "RIH with high-expansion tubing patch and set across damaged interval.", "Pressure test patch and bring well online."],
            isFlawed: false
        }
    };
    
    // --- GLOBAL STATE ---
    let appState = { currentView: 'home', selectedWell: null, generatedPlan: null, liveData: null, logEntries: [], tfaChartInstance: null, liveDataInterval: null };

    // --- TEMPLATES ---
    const templates = {
        home: `
            <div id="home-view" class="view-container fade-in-up">
                <section class="hero-section py-20 md:py-32">
                    <video autoplay loop muted playsinline id="hero-video" poster="https://welltegra.network/assets/thumbnail.png"><source src="https://welltegra.network/assets/thumbnail.mp4" type="video/mp4"></video>
                    <div class="hero-overlay"></div>
                    <div class="max-w-4xl mx-auto text-center relative z-10">
                        <h1 class="text-4xl md:text-6xl font-bold tracking-tight">From Data Chaos to Predictive Clarity.</h1>
                        <p class="mt-6 text-lg md:text-xl max-w-3xl mx-auto text-slate-200">The well engineering software ecosystem isn't broken, it's disconnected. This fragmentation creates hidden operational taxes that erode profitability and hinder performance.</p>
                    </div>
                </section>
            </div>`,
        planner: `
            <div id="planner-view" class="view-container hidden max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-8 fade-in"><h2 class="text-3xl font-bold tracking-tight">Well Intervention Planner</h2></div>
                <section id="step-1" class="fade-in-up">
                    <div class="text-center"><h3 class="text-2xl font-bold tracking-tight">Step 1: Select a Well</h3><p class="mt-4 max-w-3xl mx-auto text-sm text-slate-400">Select the "Well From Hell" to begin planning. The other wells are historical assets whose siloed data contains the key to success.</p></div>
                    <div id="well-selection-grid" class="mt-10 grid gap-8 md:grid-cols-2 lg:grid-cols-4"></div>
                </section>
                <section id="step-2" class="hidden fade-in-up">
                    <div class="text-center"><h3 class="text-2xl font-bold tracking-tight">Step 2: Choose Your Data Source</h3><p class="mt-4 max-w-3xl mx-auto text-lg text-slate-400">How do you want to plan this complex intervention?</p></div>
                    <div id="plan-choice-container" class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto"></div>
                </section>
                <section id="step-3" class="hidden fade-in-up">
                    <div class="text-center"><h3 class="text-2xl font-bold tracking-tight">Step 3: Review the Generated Plan</h3></div><div id="plan-output" class="mt-10 light-card p-6 md:p-8 space-y-8 rounded-lg"></div>
                    <div class="mt-8 flex justify-center space-x-4"><button id="start-over-btn" class="rounded-md bg-slate-600 px-6 py-3 text-base font-semibold text-white shadow-sm hover:bg-slate-500 transition-all active:scale-95">Start Over</button><button id="begin-op-btn" class="rounded-md bg-emerald-600 px-6 py-3 text-base font-semibold text-white shadow-sm hover:bg-emerald-500 transition-all active:scale-95">Begin Live Operation</button></div>
                </section>
            </div>`,
        performer: `
            <div id="performer-view" class="view-container hidden performer-view p-4 lg:p-6 h-full">
                <div class="h-full dashboard-grid">
                    <div id="procedure-panel" class="bg-slate-800/50 rounded-lg p-4 flex flex-col">
                        <h2 class="text-lg font-semibold mb-2 border-b border-slate-700 pb-2">Operational Procedure</h2>
                        <p class="text-xs text-slate-400 mb-3">Live simulation running...</p>
                        <div id="procedure-steps" class="flex-1 space-y-3 overflow-y-auto pr-2"></div>
                        <div id="performer-controls" class="hidden mt-4">
                            <button id="view-analysis-btn" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded-md transition active:scale-95">View Post-Job Analysis</button>
                        </div>
                    </div>
                    <div class="flex flex-col gap-4 lg:gap-6">
                        <div id="kpi-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4 lg:gap-6"></div>
                        <div id="chart-card" class="flex-1 bg-slate-800/50 rounded-lg p-4 flex-col">
                            <h3 class="text-lg font-semibold mb-2">Weight vs. Depth: Plan vs. Actual</h3>
                            <div class="flex-1 relative"><canvas id="tfaChart"></canvas></div>
                        </div>
                    </div>
                    <div class="bg-slate-800/50 rounded-lg p-4 flex flex-col">
                        <h2 class="text-lg font-semibold mb-4 border-b border-slate-700 pb-2">Operations Log</h2>
                        <div id="log-entries" class="flex-1 space-y-3 overflow-y-auto mb-4"></div>
                        <div class="mt-auto">
                            <textarea id="log-input" class="w-full bg-slate-900 border border-slate-600 rounded-md p-2 text-sm" rows="3" placeholder="Add log entry..."></textarea>
                            <button id="add-log-btn" class="mt-2 w-full bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-2 px-4 rounded-md transition active:scale-95">Add Entry</button>
                        </div>
                    </div>
                </div>
            </div>`,
        tree: `
            <div id="tree-view" class="view-container hidden max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
                <div class="text-center fade-in"><h2 class="text-3xl font-bold tracking-tight">Christmas Tree Integrity</h2><p id="tree-subtitle" class="mt-2 max-w-2xl mx-auto text-lg text-slate-400"></p></div>
                <div class="mt-12 grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
                    <div id="tree-schematic-container" class="light-card p-6 rounded-lg"></div>
                    <div class="space-y-8">
                        <div id="tree-status-container" class="light-card p-6 rounded-lg"></div>
                        <div id="tree-history-container" class="light-card p-6 rounded-lg"></div>
                    </div>
                </div>
            </div>`,
        analyzer: `...`,
    };
    
    // --- All other functions ---
    
    init(); // Initialize the app
});
</script>
</body>
</html>
